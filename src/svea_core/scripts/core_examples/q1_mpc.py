#!/usr/bin/env python
# -*- coding: utf-8 -*-

from __future__ import division
from __future__ import print_function

import rospy
import numpy as np

from svea.states import VehicleState
from svea.localizers import LocalizationInterface
from svea.data import BasicDataHandler, TrajDataHandler, RVIZPathHandler
from svea.models.bicycle import SimpleBicycleModel
from svea.simulators.sim_SVEA import SimSVEA
from sensor_msgs.msg import LaserScan

from svea.svea_managers.mpc_path_following_sveas import SVEAMPC
from svea.controllers.mpc.mpc import MPC

from svea.controllers.mpc.parameters import parameters
from svea.track import Track

"""
__team__ = "Team 1"
__maintainers__ = "Roberto Castro Sundin, Astrid Lindstedt, Johan Hedin, Aravind Sadashiv, Sarthak Manocha‚Äù
__status__ = "Development"
"""


## SIMULATION PARAMS ##########################################################
param_name = "ZOH-good"
params = parameters.get(param_name)

vehicle_name = ""
target_velocity = params.target_velocity # [m/s]
dt = params.dt # frequency of the model updates

# xs = [-2.33, 10.48]
# ys = [-7.09, 11.71]
# traj_x = np.linspace(xs[0], xs[1]).tolist()
# traj_y = np.linspace(ys[0], ys[1]).tolist()
# xs = [10.48,6.03]
# ys = [11.71,14.8]
# traj_x = np.append(traj_x,np.linspace(xs[0], xs[1]).tolist()[1:])
# traj_y = np.append(traj_y,np.linspace(ys[0], ys[1]).tolist()[1:])
# xs = [6.03,-6.78]
# ys = [14.8,-4]
# traj_x = np.append(traj_x,np.linspace(xs[0], xs[1]).tolist()[1:])
# traj_y = np.append(traj_y,np.linspace(ys[0], ys[1]).tolist()[1:])
# xs = [-6.78,-2.33]
# ys = [-4.00,-7.09]
# traj_x = np.append(traj_x,np.linspace(xs[0], xs[1]).tolist()[1:-1])
# traj_y = np.append(traj_y,np.linspace(ys[0], ys[1]).tolist()[1:-1])

#traj_x =  [0.53502483104700005, 0.75880470850270842, 0.97002287981715085, 1.1827769825984542, 1.3873426959305166, 1.6050772109688944, 1.8277535956462396, 2.0453636707167178, 2.2906895507981102, 2.5267343443202259, 2.7591674842625222, 2.9840820032121989, 3.1980016768456547, 3.4051196721759047, 3.6111423071368787, 3.8284260393523049, 4.051433846863687, 4.2908689735371723, 4.517754642744916, 4.7251538996644751, 4.9303804986079074, 5.1349925953115969, 5.343154241175319, 5.5739314485861904, 5.820995669089827, 6.0693229130231439, 6.3152405588258249, 6.5497272260477999, 6.7890446546182632, 7.0252472402907706, 7.2593409163450735, 7.4947941821366433, 7.7241778909644188, 7.9569410959073918, 8.1983955011000802, 8.4286264274833567, 8.6658386366725129, 8.8940739306884762, 9.1214671910622833, 9.3380304210278027, 9.5450458069467832, 9.7520409220153006, 9.9593172799343126, 10.100472263783605, 10.061310570316097, 9.8068153404225455, 9.4931769478416186, 9.1531472400072147, 8.8231039678230925, 8.4944093497119937, 8.1707524854278706, 7.8456549792563717, 7.5079428516283251, 7.169088944995984, 6.8292642550933156, 6.4833707296764338, 6.1056603511855272, 5.7097472179550612, 5.3743472375480126, 5.100721940172332, 4.8582529048621961, 4.6456738278272294, 4.4203025662515438, 4.1945613990024615, 3.9737382520267253, 3.7572834798431578, 3.5499376385807988, 3.3378768991181889, 3.11604696316618, 2.8780259321554498, 2.636473628285275, 2.3999346592863038, 2.1647648645735598, 1.9389352717067445, 1.713227749979646, 1.490929732113726, 1.2654650087096682, 1.0273339234975689, 0.78183895969569495, 0.53531085860905603, 0.31712382400008005, 0.095942397995614007, -0.14079177676856267, -0.38657378546973209, -0.63585866261010182, -0.87222742054208779, -1.1077114500526779, -1.33958174561376, -1.5727083587941053, -1.812532456726329, -2.0484495053317118, -2.2872451882803091, -2.5259539151345018, -2.7607643705361173, -3.0035352381653011, -3.2385014667457925, -3.4734017625789781, -3.7154619273617921, -3.9586753227189502, -4.2000003935198267, -4.43541700152484, -4.6630000659200705, -4.889956966605058, -5.1108828820222483, -5.3350483097428425, -5.5474110748373793, -5.7499625021779401, -5.9490975244395319, -6.1448882738627937, -6.3570107122543513, -6.5714694116019583, -6.7538349170229193, -6.8280466752527369, -6.8178607746263244, -6.6818733953671519, -6.4739462467128162, -6.2023183889180507, -5.8949408293483589, -5.5769693316725251, -5.2637251352628418, -4.9407592437433268, -4.6162229345651555, -4.2873471834389054, -3.9542932140258165, -3.6081914690783026, -3.2237649764044907, -2.827483832174372, -2.4624316198180192, -2.162198868635627, -1.8873724956341977, -1.6144416087095832, -1.3552424399908669, -1.1123141580444924, -0.86790742858136505, -0.6384418825060505, -0.4032885221541378, -0.17010355813884101, 0.057826253166703846, 0.27535901383809602]
#traj_y =  [-2.9267062403800002, -2.5951577866933073, -2.2555137887595209, -1.9167923443005552, -1.573065306770876, -1.2375483880247167, -0.90526161507239278, -0.56991837377249566, -0.25375190014768134, 0.069129414999055602, 0.39468542478746937, 0.72544756659928167, 1.0634419380889937, 1.4056342037599125, 1.7485335269822935, 2.084302355025891, 2.4164525567438662, 2.7368129739652307, 3.0662016676266832, 3.408232495177689, 3.7515720911471306, 4.0952821149968957, 4.4368344147538084, 4.7635225202918248, 5.0781189971052285, 5.391711843962641, 5.7071083003319441, 6.031215131225526, 6.3517281206901979, 6.6745148631823543, 6.9988549314423461, 7.3222223295205824, 7.6499089312615789, 7.975207376013107, 8.2941305245715533, 8.6212147769265695, 8.9432785794551215, 9.2717730672557881, 9.6008762904009366, 9.9370927690451865, 10.279366029475124, 10.621585408929942, 10.96369806700195, 11.336987086516137, 11.729851114582898, 12.037434716113962, 12.284623281834802, 12.495391819854914, 12.721368323773021, 12.949317040473112, 13.184341893742017, 13.417320426302373, 13.631717397441809, 13.84417298054953, 14.055021356024316, 14.25578692911076, 14.386443743014716, 14.372122815928119, 14.161035485040866, 13.868755851205322, 13.551409198793747, 13.212463746041843, 12.881981144518733, 12.551842787462739, 12.218274552328818, 11.881965127947698, 11.539861269780451, 11.200740082027091, 10.867807732034889, 10.546429250457928, 10.227596968894302, 9.9050271588477674, 9.5814416439445047, 9.2513126085345423, 8.9210801211356952, 8.5885459928904933, 8.2583118967982774, 7.9367881223404364, 7.6209975759603994, 7.3062870370859976, 6.9708047879204669, 6.6375709042982187, 6.3151362726107241, 5.9995564283338432, 5.68668876169599, 5.3640702530838613, 5.0406977416315728, 4.7147818698355461, 4.3897915712157864, 4.0696359924075898, 3.746612875921401, 3.425710929387678, 3.1047592324096533, 2.7809515741484172, 2.4630430293943273, 2.139314397022742, 1.8155578978459934, 1.4971120933227171, 1.1795459346569357, 0.86054483472265209, 0.53715069714125407, 0.20821357977259397, -0.12118510079530535, -0.45460847605563193, -0.78595736627436064, -1.1247618008236664, -1.4697765908667226, -1.8166353291615334, -2.1654833705195937, -2.504617024377469, -2.842073717015003, -3.1977967158624083, -3.5915864208756663, -3.9892804453979487, -4.3671625924409643, -4.7077234360058933, -5.0019971420852904, -5.2576667823711833, -5.50035177214263, -5.7490913388986762, -5.9851087376965317, -6.2189619427410099, -6.4465528950401918, -6.6681090879680545, -6.8685530484685557, -6.9739007047398527, -6.925562550158026, -6.7623666270415805, -6.4984973445403611, -6.2080463958222305, -5.9157464216980298, -5.6109371630737677, -5.2932613856500499, -4.9766482281797755, -4.6489759720222237, -4.3254125003092048, -4.0003697047894189, -3.6717492024444853, -3.3360290634512522]
# traj_x = traj_x[::-1]
# traj_y = traj_y[::-1]
# traj_x = [-0.212822934793, -0.212898920745, -0.213009170353, -0.213169870238, -0.213074540097, -0.213109566356, -0.213099328734, -0.213172409473, -0.213282882968, -0.213343725174, -0.213280121986, -0.213307983956, -0.213343450051, -0.213323724905, -0.213369132933, -0.213599641151, -0.213635737573, -0.213554575689, -0.213714574413, -0.213793860152, -0.213903818072, -0.213986407328, -0.212155045485, -0.200519333859, -0.128209035839, -0.00909045574095, 0.121391656804, 0.248876450376, 0.351461631497, 0.449195354695, 0.531642109716, 0.610323547263, 0.640884842522, 0.684553454663, 0.726823516248, 0.75535541017, 0.740602811479, 0.659877256361, 0.579951870542, 0.532926853181, 0.499833307231, 0.505113700529, 0.530767953442, 0.576552535154, 0.63848492427, 0.72654382148, 0.844227496109, 0.918120325219, 0.922885817071, 0.924557605021, 0.922463761216, 0.877414301513, 0.762325246978, 0.558679815071, 0.285928263256, -0.00147554862399, -0.305911714857, -0.589158762813, -0.83368842013, -1.09338284044, -1.34550521001, -1.56683260362, -1.77963957029, -2.0078947474, -2.21245731475, -2.40545888496, -2.60877675227, -2.79168768821, -3.00164501678, -3.20681949326, -3.4244290711, -3.61907545065, -3.81613934661, -4.02660116849, -4.22250316775, -4.40439848706, -4.59517220944, -4.79642862628, -5.00832256107, -5.22226618465, -5.41304127398, -5.58459184268, -5.75041631234, -5.9294858024, -6.11515697244, -6.29159878369, -6.44432471237, -6.5515309703, -6.59792801075, -6.56847562018, -6.45126609363, -6.23697366806, -5.96869815865, -5.65125066993, -5.387965902, -5.13185650503, -4.85741364192, -4.59594463783, -4.32407668324, -4.06883613492, -3.79534897685, -3.51188917419, -3.25572664964, -2.97918230861, -2.69233223133, -2.38848066961, -2.08538870904, -1.81913189037, -1.57761621589, -1.31414377143, -1.06537004398, -0.8334497635, -0.612054456984, -0.397578447836, -0.166053812271, 0.0626967807201, 0.264160589415, 0.445424931991, 0.623946301211, 0.820061995221, 0.997025151249, 1.21133628683, 1.43284637039, 1.64186601771, 1.84003341205, 2.02857655458, 2.19266827125, 2.35656861001, 2.46782158496, 2.5630462034, 2.62407818719, 2.63923509587, 2.57921224639, 2.43937558825, 2.32145832294, 2.21729123597, 2.10320044984, 2.01327848784, 1.92092042711, 1.84289476539, 1.77389469393, 1.70191928346, 1.62386527132, 1.5836269441, 1.5879805348, 1.62804249771, 1.77966650224, 1.992693442, 2.2337372957, 2.45488076762, 2.68928752868, 2.94090622004, 3.23324010711, 3.49385165591, 3.72561061785, 3.92886629517, 4.11953104799, 4.31185443711, 4.51622555447, 4.67165605469, 4.81240012422, 4.92281407543, 5.023065782, 5.1351909744, 5.26534868873, 5.40155879747, 5.548823131, 5.69583361029, 5.86773731905, 6.04144926806, 6.22893177076, 6.46072849013, 6.71807816015, 6.9850206866, 7.23808181121, 7.50117791562, 7.75292973008, 7.98275468267, 8.18379691324, 8.4196082322, 8.65637667251, 8.88078159993, 9.08428918646, 9.28692746692, 9.49912997746, 9.61823773133, 9.65595769593, 9.58592858235, 9.45790518518, 9.27722504702, 9.11678462238, 8.96248551934, 8.79714752377, 8.62281338019, 8.44157573322, 8.26723602141, 8.06047106656, 7.80613849677, 7.54701555671, 7.26476774494, 7.04455475635, 6.68302816006, 6.2760407888, 5.71653117347, 5.09094607283, 4.5062179606, 3.97910846605, 3.60793307305, 3.43121484534, 3.42107944715, 3.42050829664, 3.42047459546, 3.42166636444, 3.42331480054, 3.42197935693, 3.42442709868, 3.42512928597, 3.42450675822, 3.42465641524, 3.42316445169, 3.4243867848, 3.42213382548, 3.41992923391, 3.4187362542, 3.41854513078, 3.41702226921]
# traj_y = [-3.54833023529, -3.54818545992, -3.54811284336, -3.54817823833, -3.54802457317, -3.54779681783, -3.5477507919, -3.54742971932, -3.54736039182, -3.54715590926, -3.54692267673, -3.54645918126, -3.54640471109, -3.54618342207, -3.54608157158, -3.5460321222, -3.54595863095, -3.54579879381, -3.54562991031, -3.54546797828, -3.54537450399, -3.54529398872, -3.54319192774, -3.52851410035, -3.43083572323, -3.25223200066, -3.05112332311, -2.82781526311, -2.59629062968, -2.35378673848, -2.1254349953, -1.89166622171, -1.65575977752, -1.39728265863, -1.10163586152, -0.759803365122, -0.397820596746, -0.0450769777309, 0.266826849535, 0.606537709371, 0.966233666702, 1.31121072996, 1.66290442098, 2.01651072306, 2.35391064762, 2.70062566396, 3.05528506823, 3.3530901662, 3.67895448937, 4.03492825644, 4.35807225022, 4.67949309961, 4.9736838395, 5.1989885211, 5.36403637096, 5.43879995582, 5.41503337917, 5.30335164493, 5.1075587278, 4.90213766062, 4.71249268377, 4.48614632911, 4.20653669617, 3.9025789197, 3.63799790342, 3.38136972474, 3.10428960946, 2.83588569704, 2.54410753519, 2.27143625379, 1.98280285211, 1.70951372524, 1.45647273084, 1.17618277486, 0.904260352442, 0.626237909323, 0.356589194416, 0.0753010632771, -0.213510172848, -0.503125656284, -0.778998092669, -1.03112662814, -1.30573281944, -1.59620184837, -1.89879557568, -2.18907424418, -2.47753712026, -2.78375762498, -3.08740480795, -3.39018015523, -3.67097859285, -3.8863979814, -4.04982076044, -4.25208797837, -4.46951292205, -4.65772377088, -4.86352896493, -5.06144776518, -5.26233594759, -5.46773145921, -5.68799741563, -5.90369067722, -6.11951735406, -6.30640594947, -6.42528227747, -6.45267678286, -6.41417281134, -6.30021498725, -6.11697309142, -5.89539625108, -5.67380777989, -5.43789989297, -5.19663474822, -4.94125896301, -4.68306900196, -4.42660307485, -4.16337574388, -3.91167295065, -3.63057471792, -3.32419059655, -3.07305035385, -2.75527176613, -2.43478713807, -2.10852658337, -1.76725100683, -1.3885846295, -0.984809583506, -0.574921133165, -0.189150044982, 0.24702937931, 0.712860473722, 1.19515351078, 1.67767794424, 2.17327112202, 2.68955469674, 3.18377348962, 3.66045027438, 4.13591559696, 4.63100702878, 5.11746965453, 5.62058031935, 6.10046383962, 6.59313270412, 7.10729042516, 7.6000833606, 8.09413440035, 8.56144072692, 9.01844548696, 9.4511875886, 9.88314252205, 10.3094234994, 10.7085237879, 11.1175414989, 11.4755319969, 11.8050563108, 12.0725100446, 12.3400394069, 12.5925472008, 12.86121691, 13.0787272784, 13.2692948903, 13.4217798864, 13.5560851359, 13.7120443231, 13.871383049, 14.0175962104, 14.1155078855, 14.1628708757, 14.1449686628, 14.1041777604, 13.9984704002, 13.8709333809, 13.7423248404, 13.6024185656, 13.4796417768, 13.3407657478, 13.2084224197, 13.0711341347, 12.9512045518, 12.7954924397, 12.6363589553, 12.4565271696, 12.290468534, 12.1172126793, 11.9291906773, 11.7401274174, 11.5169442709, 11.247092108, 10.9293556706, 10.5959419981, 10.278043026, 9.94520014545, 9.63441808314, 9.31097433486, 8.96968496466, 8.62485923945, 8.23785160989, 7.81732946418, 7.39333815623, 6.97114385353, 6.61443113098, 6.0785702665, 5.41437341479, 4.61750328347, 3.81401519132, 3.01061395531, 2.40155033492, 1.96323871436, 1.74383783601, 1.73756820567, 1.74482277473, 1.75223812886, 1.75820354203, 1.75778849776, 1.75565441092, 1.75507364774, 1.75350220103, 1.75058304584, 1.74819815946, 1.74512401294, 1.74128426012, 1.73628880022, 1.73100373934, 1.72731893016, 1.72385113345, 1.71973963231]
'''ZIZZAGPATH from global pathplanning'''
#traj_x =  [15.1, 15.399999999999993, 15.699999999999987, 15.99999999999998, 16.300000000000026, 16.600000000000072, 16.90000000000012, 17.200000000000166, 17.500000000000213, 17.799433667377695, 18.098807780511887, 18.398807780511934, 18.698241447889416, 18.997615561023608, 19.297615561023655, 19.697049228401138, 19.996235339533772, 20.285062047548035, 20.545323444362175, 20.76061420825162, 20.91736369720348, 21.05426075031541, 21.20605766425985, 21.357854578204286, 21.509651492148723, 21.66144840609316, 21.9132453200376, 22.094846012397696, 22.329953622305588, 22.603748372308125, 22.89897187904427, 23.198805083650075, 23.49863828825588, 23.798471492861683, 24.098304697467487, 24.39813790207329, 24.697971106679095, 24.9978043112849, 25.297637515890703, 25.59637732233376, 25.895021273929334, 26.194854478535138, 26.593594284978195, 26.882420992992458, 27.1426823898066, 27.357973153696044, 27.514722642647904, 27.637417169254903, 27.7601116958619, 27.897008748973832, 28.034875881663677, 28.257570408270677, 28.412175837773972, 28.625715488533682, 28.884729098234484, 29.172889998187905, 29.472034248869875, 29.771408362004067, 30.071408362004114, 30.37140836200416, 30.671408362004208, 30.971408362004254, 31.2714083620043, 31.571408362004348, 31.871408362004395, 32.17140836200438, 32.47140836200432, 32.77140836200426, 33.0714083620042, 33.37140836200414, 33.67140836200408, 33.97140836200402, 34.27140836200396, 34.5714083620039, 34.87084202938137, 35.17021614251556, 35.5702161425155, 35.867213612617135, 36.145805308760664, 36.388430476792855, 36.579795477362005, 36.707837805465054, 36.76448643861231, 36.78260051108384, 36.800714583555376, 36.81882865602691, 36.83694272849844, 36.855056800969976, 36.87317087344151, 36.89128494591304, 36.909399018384576, 36.92751309085611, 36.94562716332764, 36.963741235799176, 36.96353945546735, 36.87141363851946, 36.711284917884996, 36.49324685031693, 36.231043251419294, 35.9412018677189, 35.64199256638355, 35.34305590828877, 35.044036059156674, 34.74509940106189, 34.4460795519298, 34.14714289383502, 33.84812304470292, 33.54918638660814, 33.25016653747605, 32.951229879381266, 32.65221003024917, 32.35477642359155, 32.05583976549677, 31.756819916364687, 31.459386309707067, 31.1604496516123, 30.861429802480217, 30.563996195822597, 30.26505953772783, 29.966039688595746, 29.668606081938126, 29.36966942384336, 29.070649574711275, 28.773215968053655, 28.474279309958888, 28.175259460826805, 27.877825854169185, 27.578889196074417, 27.279869346942334, 26.982435740284714, 26.387359714005154, 26.111202456325643, 25.872434610865255, 25.68610667443303, 25.50174970274531, 25.315421766313086, 25.131064794625367, 24.944736858193142, 24.776680669659868, 24.60772174867813, 24.48557871988262, 24.365731909893903, 24.181374938206183, 23.99504700177396, 23.81069003008624, 23.624362093654014, 23.440005121966294, 23.202758749359784, 22.963990903899397, 22.777662967467172, 22.636705011319393, 22.479127555308022, 22.161843937908735, 21.945878602322235, 21.68513855013837, 21.3960592746532, 21.09686260429115, 20.79905006843447, 20.501237532577793, 20.203424996721115, 19.905612460864436, 19.607799925007757, 19.30998738915108, 19.0121748532944, 18.714362317437722, 18.416549781581043, 18.118737245724365, 17.820924709867686, 17.523112174011008, 17.22529963815433, 16.92748710229765, 16.629674566440972, 16.331862030584293, 16.034049494727615, 15.736236958870984, 15.440893270574133, 15.145740059970926, 14.9479275241143, 14.657473027356492, 14.394069218350596, 14.17431949768971, 14.012075573350732, 13.917564331876264, 13.896743196618214, 13.950924607403458, 14.027828281858163, 14.103676585025683, 14.180580259480388, 14.256428562647908, 14.333332237102614, 14.409180540270134, 14.486084214724839, 14.561932517892359, 14.638836192347064, 14.714684495514584, 14.79158816996929, 14.86743647313681, 14.944340147591515]
#traj_y = [1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.524182495318074, 1.5072752483923575, 1.5072752483923575, 1.4914577437104315, 1.474550496784715, 1.474550496784715, 1.458732992102789, 1.4624665427491146, 1.540603609706744, 1.6882188996446383, 1.8960076276329458, 2.1508720351292245, 2.4176489296736325, 2.676410783347938, 2.935172637022243, 3.1939344906965483, 3.4526963443708536, 3.711458198045159, 3.9492552901834603, 4.134324683272896, 4.255000709749357, 4.303676674716769, 4.313679145202437, 4.3236816156881055, 4.333684086173774, 4.343686556659442, 4.35368902714511, 4.363691497630779, 4.373693968116447, 4.383696438602115, 4.4094887370621425, 4.436368186254134, 4.446370656739802, 4.472162955199829, 4.550300022157461, 4.697915312095358, 4.905704040083665, 5.160568447579943, 5.434331215575672, 5.708093983571401, 5.97487087811581, 6.2411477421828385, 6.514910510178567, 6.771081214325625, 6.980669110084234, 7.130463030137275, 7.2110208617437195, 7.217264721048654, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.200357474122939, 7.2161749788048635, 7.233082225730579, 7.233082225730579, 7.1967673355569435, 7.087620941503058, 6.91252297940056, 6.682510577447379, 6.412082341663754, 6.118284450490853, 5.818831815874811, 5.519379181258769, 5.219926546642727, 4.920473912026685, 4.621021277410643, 4.321568642794601, 4.022116008178559, 3.7226633735625043, 3.423210738946449, 3.1237581043303937, 2.8243054697143384, 2.226204550269486, 1.9415308733220356, 1.6887759301002176, 1.4838718803933466, 1.3397346498794507, 1.2654497874260004, 1.26569976643371, 1.2891003873788112, 1.3114128152725166, 1.3348134362176178, 1.3571258641113233, 1.3805264850564245, 1.40283891295013, 1.4262395338952312, 1.4485519617889366, 1.4719525827340378, 1.4942650106277433, 1.5334217422407537, 1.5568223631858549, 1.5791347910795603, 1.6182915226925707, 1.641692143637672, 1.6640045715313774, 1.7031613031443877, 1.726561924089489, 1.7488743519831944, 1.7880310835962048, 1.811431704541306, 1.8337441324350114, 1.8729008640480218, 1.896301484993123, 1.9186139128868285, 1.9577706444998388, 1.98117126544494, 2.0034836933386457, 2.042640424951656, 2.1087931581978823, 2.22396015662203, 2.4042826024497796, 2.63839404727895, 2.8740607090816455, 3.108172153910816, 3.3438388157135113, 3.5779502605426816, 3.8262803475421414, 4.07399711652272, 4.347140575188227, 4.621299307733124, 4.8569659695358185, 5.091077414364988, 5.3267440761676825, 5.560855520996852, 5.796522182799547, 5.978841757119339, 6.159164202947087, 6.393275647776257, 6.657929325650058, 6.912282650480067, 7.419658129497872, 7.626745652830653, 7.773513815871053, 7.8507112315018235, 7.853471836391127, 7.817309791556274, 7.7811477467214205, 7.744985701886567, 7.708823657051714, 7.672661612216861, 7.636499567382008, 7.600337522547155, 7.564175477712301, 7.528013432877448, 7.491851388042595, 7.455689343207742, 7.419527298372889, 7.383365253538035, 7.347203208703182, 7.311041163868329, 7.274879119033476, 7.238717074198623, 7.2025550293637695, 7.1507590797470435, 7.09788851247086, 7.0617264676360065, 6.989876249763942, 6.847944217099421, 6.644876916027688, 6.393474494579163, 6.109583857660558, 5.81109977295643, 5.516836891810307, 5.227015326931408, 4.936915775880226, 4.647094211001327, 4.356994659950145, 4.0671730950712455, 3.7770735440200633, 3.487251979141164, 3.1971524280899817, 2.907330863211082, 2.6172313121599, 2.3274097472810005, 2.0373101962298183, 1.7474886313509175]
'''NORMAL path from global pathplanning'''
#traj_x = [15.1, 15.399999999999993, 15.699999999999987, 15.99999999999998, 16.300000000000026, 16.600000000000072, 16.90000000000012, 17.200000000000166, 17.500000000000213, 17.80000000000026, 18.100000000000307, 18.400000000000354, 18.7000000000004, 19.000000000000448, 19.300000000000495, 19.60000000000054, 19.90000000000059, 20.200000000000635, 20.500000000000682, 20.80000000000073, 21.100000000000776, 21.400000000000823, 21.70000000000087, 22.000000000000917, 22.300000000000963, 22.60000000000101, 22.900000000001057, 23.200000000001104, 23.50000000000115, 23.800000000001198, 24.100000000001245, 24.40000000000129, 24.70000000000134, 25.000000000001386, 25.300000000001432, 25.60000000000148, 25.900000000001526, 26.200000000001573, 26.50000000000162, 26.800000000001667, 27.100000000001714, 27.40000000000176, 27.700000000001808, 28.000000000001855, 28.3000000000019, 28.60000000000195, 28.900000000001995, 29.200000000002042, 29.50000000000209, 29.800000000002136, 30.100000000002183, 30.40000000000223, 30.700000000002277, 31.000000000002323, 31.30000000000237, 31.600000000002417, 31.900000000002464, 32.20000000000244, 32.50000000000238, 32.80000000000232, 33.10000000000226, 33.4000000000022, 33.70000000000214, 33.99943366737961, 34.2988077805138, 34.59880778051374, 34.89824144789121, 35.197615561025394, 35.497615561025334, 35.89704922840281, 36.19623533953543, 36.48506204754969, 36.74532344436383, 36.96061420825326, 37.1173636972051, 37.20569136101907, 37.22002955209248, 37.21123133977523, 37.21935112063529, 37.227470901495344, 37.2355906823554, 37.24371046321546, 37.251830244075514, 37.25995002493557, 37.268069805795626, 37.27618958665568, 37.28430936751574, 37.292429148375795, 37.27228585758349, 37.17071979433642, 37.002252856613275, 36.77750419249801, 36.51064061346214, 36.21848360330716, 35.91881306473572, 35.618883726958735, 35.31895438918175, 35.01902505140476, 34.71909571362777, 34.419166375850786, 34.1192370380738, 33.81930770029681, 33.519378362519824, 33.219449024742836, 32.91951968696585, 32.61959034918886, 32.319661011411874, 32.01973167363489, 31.719802335857796, 31.419872998080702, 31.11994366030361, 30.820014322526514, 30.52008498474942, 30.220155646972326, 29.920226309195233, 29.62029697141814, 29.320367633641045, 29.02043829586395, 28.720508958086857, 28.420579620309763, 28.12065028253267, 27.820720944755575, 27.52079160697848, 27.220862269201387, 26.920932931424293, 26.6210035936472, 26.321074255870105, 26.02114491809301, 25.721215580315917, 25.4215091523501, 25.12183861377865, 24.821909276001556, 24.52220284803574, 24.222532309464288, 23.922602971687194, 23.622896543721378, 23.323226005149927, 23.023296667372833, 22.723590239407017, 22.423919700835565, 22.12399036305847, 21.824061025281377, 21.52435459731556, 21.22468405874411, 20.924754720967016, 20.6250482930012, 20.32537775442975, 20.025448416652655, 19.72574198868684, 19.426071450115387, 19.126142112338293, 18.826435684372477, 18.526765145801026, 18.22683580802393, 17.927129380058116, 17.627458841486664, 17.32752950370957, 17.027823075743754, 16.728152537172303, 16.42822319939521, 16.128516771429393, 15.82884623285794, 15.528916895080899, 14.930175856249761, 14.643112997893926, 14.386116617597159, 14.1753862299722, 14.024205018189717, 13.942102541563385, 13.934254049131011, 14.001154262910482, 14.07049919607521, 14.13739940985468, 14.206744343019407, 14.273644556798878, 14.342989489963605, 14.409889703743076, 14.479234636907803, 14.546134850687274, 14.615479783852, 14.682379997631472, 14.751724930796199, 14.798490628573454, 14.861913744272584, 14.925336859971715]
#traj_y = [1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.524182495318074, 1.5072752483923575, 1.5072752483923575, 1.4914577437104315, 1.474550496784715, 1.474550496784715, 1.458732992102789, 1.4624665427491146, 1.540603609706744, 1.6882188996446383, 1.8960076276329458, 2.1508720351292245, 2.436746994333875, 2.7356126577544804, 3.0353347057814974, 3.3352248009143373, 3.635114896047177, 3.935004991180017, 4.234895086312857, 4.534785181445697, 4.834675276578537, 5.134565371711377, 5.434455466844216, 5.734345561977056, 6.034235657109896, 6.631997313953263, 6.9134410974902, 7.160716570170533, 7.358236965252915, 7.493551778482166, 7.55813157340593, 7.568537481621252, 7.562026541550107, 7.555515601478962, 7.5490046614078175, 7.5424937213366725, 7.535982781265528, 7.529471841194383, 7.522960901123238, 7.516449961052093, 7.509939020980948, 7.503428080909803, 7.496917140838658, 7.490406200767513, 7.483895260696368, 7.477384320625223, 7.470873380554078, 7.464362440482933, 7.457851500411788, 7.451340560340643, 7.444829620269498, 7.438318680198353, 7.4318077401272085, 7.4252968000560635, 7.418785859984919, 7.412274919913774, 7.405763979842629, 7.399253039771484, 7.392742099700339, 7.386231159629194, 7.379720219558049, 7.373209279486904, 7.366698339415759, 7.360187399344614, 7.353676459273469, 7.347165519202324, 7.356480649338857, 7.366886557554179, 7.360375617483034, 7.3696907476195666, 7.380096655834889, 7.373585715763744, 7.382900845900276, 7.393306754115598, 7.386795814044453, 7.396110944180986, 7.406516852396308, 7.400005912325163, 7.393494972254018, 7.402810102390551, 7.413216010605873, 7.406705070534728, 7.4160202006712606, 7.426426108886583, 7.419915168815438, 7.42923029895197, 7.439636207167292, 7.433125267096147, 7.44244039723268, 7.452846305448002, 7.446335365376857, 7.45565049551339, 7.466056403728712, 7.459545463657567, 7.4688605937940995, 7.479266502009422, 7.472755561938277, 7.482070692074809, 7.492476600290131, 7.485965660218986, 7.485054842980147, 7.400667735862582, 7.247438727481479, 7.03502645799939, 6.77682012635922, 6.489095515269175, 6.189989063212997, 5.898354651849457, 5.607291860102596, 5.315657448739056, 5.024594656992195, 4.7329602456286555, 4.441897453881794, 4.1502630425182545, 3.8592002507713956, 3.5675658394078584, 3.276503047661, 2.984868636297463, 2.6938058445506043, 2.397624001547195, 2.1044047859507184, 1.8111855703542377]
'''Fine tuned normal path'''
#traj_x = [15.1, 15.399999999999993, 15.699999999999987, 15.99999999999998, 16.300000000000026, 16.600000000000072, 16.90000000000012, 17.200000000000166, 17.500000000000213, 17.80000000000026, 18.100000000000307, 18.400000000000354, 18.7000000000004, 19.000000000000448, 19.300000000000495, 19.60000000000054, 19.90000000000059, 20.200000000000635, 20.500000000000682, 20.80000000000073, 21.100000000000776, 21.400000000000823, 21.70000000000087, 22.000000000000917, 22.300000000000963, 22.60000000000101, 22.900000000001057, 23.200000000001104, 23.50000000000115, 23.800000000001198, 24.100000000001245, 24.40000000000129, 24.70000000000134, 25.000000000001386, 25.300000000001432, 25.60000000000148, 25.900000000001526, 26.200000000001573, 26.50000000000162, 26.800000000001667, 27.100000000001714, 27.40000000000176, 27.700000000001808, 28.000000000001855, 28.3000000000019, 28.60000000000195, 28.900000000001995, 29.200000000002042, 29.50000000000209, 29.800000000002136, 30.100000000002183, 30.40000000000223, 30.700000000002277, 31.000000000002323, 31.30000000000237, 31.600000000002417, 31.900000000002464, 32.20000000000244, 32.50000000000238, 32.80000000000232, 33.10000000000226, 33.4000000000022, 33.70000000000214, 33.99943366737961, 34.2988077805138, 34.59880778051374, 34.89824144789121, 35.197615561025394, 35.497615561025334, 35.89704922840281, 36.19623533953543, 36.48506204754969, 36.74532344436383, 36.96061420825326, 37.1173636972051, 37.20569136101907, 37.22002955209248, 37.21123133977523, 37.21935112063529, 37.227470901495344, 37.2355906823554, 37.24371046321546, 37.251830244075514, 37.25995002493557, 37.268069805795626, 37.27618958665568, 37.28430936751574, 37.264166076723434, 37.162600013476364, 36.99413307575322, 36.76938441163795, 36.50252083260208, 36.21036382244711, 35.911329211581766, 35.613338971080594, 35.31379347436366, 35.01424797764673, 34.7147024809298, 34.41515698421287, 34.117047316864394, 33.81905707636322, 33.51951157964629, 33.221401912297814, 32.62356129495595, 32.323710419303865, 32.02386004246317, 31.72400916681109, 31.42415878997039, 31.124307914318308, 30.82445753747761, 30.524606661825526, 30.224756284984828, 29.924905409332744, 29.625055032492046, 29.325204156839963, 29.025353779999264, 28.72550290434718, 28.425652527506482, 28.1258016518544, 27.8259512750137, 27.526100399361617, 27.22625002252092, 26.926399146868835, 26.626548770028137, 26.326697894376053, 26.026847517535355, 25.72699664188327, 25.427146265042573, 25.12729538939049, 24.82744501254979, 24.5278845514912, 24.228033675839118, 23.92818329899842, 23.62862283793983, 23.328771962287746, 23.028921585447048, 22.729361124388458, 22.429510248736374, 22.129659871895676, 21.830099410837086, 21.530538949778496, 21.230688074126412, 20.930837697285714, 20.631277236227124, 20.33142636057504, 20.031575983734342, 19.732015522675752, 19.43216464702367, 19.13231427018297, 18.83275380912438, 18.532902933472297, 18.2330525566316, 17.93349209557301, 17.633641219920925, 17.333790843080227, 17.034230382021637, 16.734379506369553, 16.434529129528855, 16.134968668470265, 15.83511779281818, 15.236740012887525, 14.952650355568135, 14.700905756759507, 14.497374690182433, 14.354886536870813, 14.2824228977291, 14.263909938035656, 14.262300624506018, 14.26069131097638, 14.259081997446742, 14.257472683917104, 14.255863370387466, 14.254254056857828, 14.25264474332819, 14.235221190727412, 14.216708231033968, 14.21509891750433, 14.29767536490355, 14.299803914308374, 14.376390481236983, 14.522607506605985, 14.729238343720361, 14.983258220552536, 15.26865524346449, 15.56743969120897, 15.866556369699373, 16.165673048189745, 16.464789726680095, 16.763906405170445, 17.063023083660795, 17.362139762151145, 17.661256440641495, 17.960373119131845, 18.259489797622194, 18.558606476112544, 18.857723154602894, 19.156839833093244, 19.45660476554548, 19.756393882802122, 20.055510561292472]
#traj_y = [1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.54, 1.524182495318074, 1.5072752483923575, 1.5072752483923575, 1.4914577437104315, 1.474550496784715, 1.474550496784715, 1.458732992102789, 1.4624665427491146, 1.540603609706744, 1.6882188996446383, 1.8960076276329458, 2.1508720351292245, 2.436746994333875, 2.7356126577544804, 3.0353347057814974, 3.3352248009143373, 3.635114896047177, 3.935004991180017, 4.234895086312857, 4.534785181445697, 4.834675276578537, 5.134565371711377, 5.434455466844216, 5.734345561977056, 6.332107218820423, 6.61355100235736, 6.860826475037693, 7.058346870120075, 7.193661683349326, 7.25824147827309, 7.248015530897718, 7.214660903339672, 7.1981534687549225, 7.181646034170173, 7.165138599585424, 7.148631165000674, 7.116361351755743, 7.083006724197697, 7.066499289612947, 7.034229476368016, 7.00019211754351, 7.0006007545086675, 6.999918023242208, 7.0003266602073655, 6.999643928940906, 7.0000525659060635, 6.999369834639604, 6.9997784716047615, 6.999095740338302, 6.9995043773034595, 6.998821646037, 6.9992302830021575, 6.998547551735698, 6.998956188700856, 6.998273457434396, 6.998682094399554, 6.997999363133094, 6.998408000098252, 6.997725268831792, 6.99813390579695, 6.99745117453049, 6.997859811495648, 6.997177080229188, 6.997585717194346, 6.996902985927886, 6.997311622893044, 6.996628891626584, 7.01286250399033, 7.013271140955487, 7.012588409689028, 7.028822022052773, 7.02923065901793, 7.028547927751471, 7.044781540115216, 7.045190177080373, 7.044507445813914, 7.060741058177659, 7.0769746705414045, 7.077383307506562, 7.0767005762401025, 7.092934188603848, 7.093342825569005, 7.092660094302546, 7.108893706666291, 7.109302343631448, 7.108619612364989, 7.124853224728734, 7.125261861693891, 7.124579130427432, 7.140812742791177, 7.141221379756335, 7.140538648489875, 7.156772260853621, 7.157180897818778, 7.156498166552319, 7.172731778916064, 7.173140415881221, 7.152267139811217, 7.058355824735517, 6.896643346967788, 6.677323093837591, 6.414219702257512, 6.123917636303039, 5.824638527548555, 5.524642844063014, 5.224647160577473, 4.924651477091932, 4.624655793606391, 4.32466011012085, 4.024664426635309, 3.7246687431497554, 3.4253242352190805, 3.1260451264645956, 2.8260494429790413, 2.5267049350483664, 2.2275031005410773, 1.9382613914789386, 1.6772118751274692, 1.4608095515528163, 1.3026951288417232, 1.2128351944544293, 1.1968939811654413, 1.2198986035024852, 1.2429032258395292, 1.265907848176573, 1.288912470513617, 1.311917092850661, 1.3349217151877049, 1.3579263375247488, 1.3809309598617927, 1.4039355821988366, 1.4269402045358806, 1.4499448268729245, 1.4729494492099684, 1.4801397124451408, 1.4862388753361506, 1.5092434976731945]
'''q1 path'''
#traj_x = [11.049999999999999, 11.34943366737748, 11.648807780511673, 11.948241447889155, 12.247615561023347, 12.547049228400828, 12.84642334153502, 13.145857008912502, 13.445231122046694, 13.744664789424176, 14.044038902558368, 14.34347256993585, 14.642846683070042, 14.942280350447524, 15.241654463581716, 15.541088130959197, 15.84046224409339, 16.139895911470866, 16.439270024605058, 16.73870369198254, 17.038077805116732, 17.337511472494214, 17.636885585628406, 17.936885585628453, 18.236319253005934, 18.535693366140126, 18.835693366140173, 19.135127033517655, 19.434501146651847, 19.734501146651894, 20.033934814029376, 20.333308927163568, 20.633308927163615, 20.932742594541097, 21.23211670767529, 21.532116707675335, 21.831550375052817, 22.13092448818701, 22.430924488187056, 22.730358155564538, 23.02973226869873, 23.329732268698777, 23.629732268698824, 23.929165936076306, 24.228540049210498, 24.528540049210545, 24.827973716588026, 25.12734782972222, 25.427347829722265, 25.726781497099747, 26.02615561023394, 26.326155610233986, 26.625589277611468, 26.92496339074566, 27.224963390745707, 27.52439705812319, 27.82377117125738, 28.123771171257427, 28.42320483863491, 28.7225789517691, 29.022578951769148, 29.32201261914663, 29.621386732280822, 29.92138673228087, 30.22082039965835, 30.520194512792543, 30.82019451279259, 31.11962818017007, 31.419002293304263, 31.71900229330431, 32.01843596068179, 32.31781007381598, 32.61781007381592, 32.91724374119339, 33.21661785432757, 33.516617854327514, 33.816051521704985, 34.11542563483917, 34.41542563483911, 34.71485930221658, 35.014233415350766, 35.31423341535071, 35.61366708272818, 35.91304119586236, 36.2130411958623, 36.512474863239774, 36.81184897637396, 37.1118489763739, 37.41128264375137, 37.710656756885555, 38.010656756885496, 38.31009042426297, 38.60946453739715, 38.90946453739709, 39.20889820477456, 39.60827231790875, 39.90770598528622, 40.207080098420406, 40.50651376579788, 40.80588787893206, 41.10532154630953, 41.40469565944372, 41.70412932682119, 42.003503439955374, 42.302937107332845, 42.60231122046703, 42.9017448878445, 43.201119000978686, 43.50055266835616, 43.79992678149034, 44.09936044886781, 44.398734562002, 44.69816822937947, 44.997542342513654, 45.296976009891125, 45.59635012302531, 45.89578379040278, 46.195157903536966, 46.49459157091444, 46.79396568404862, 47.09339935142609, 47.39277346456028, 47.69220713193775, 47.990420504639104, 48.38979461777329, 48.68679208787493, 48.96538378401846, 49.20800895205065, 49.3993739526198, 49.527416280722846, 49.5840649138701, 49.56574906106674, 49.52434126812412, 49.49973240172751, 49.47512353533091, 49.450514668934304, 49.4259058025377, 49.401296936141094, 49.31613299427467, 49.18450168201439, 48.99009138354752, 48.7451565612413, 48.46513644123788, 48.16768181698668, 47.86797538902088, 47.56912273307473, 47.27027007712858, 46.97141742118243, 46.67256476523628, 46.37371210929013, 46.07485945334398, 45.776006797397834, 45.477154141451685, 45.178301485505536, 44.87944882955939, 44.58059617361324, 44.28174351766709, 43.98289086172094, 43.68403820577479, 43.38518554982864, 43.08633289388249, 42.78748023793634, 42.488627581990194, 42.189774926044045, 41.890922270097896, 41.59206961415175, 41.2932169582056, 40.99436430225945, 40.6955116463133, 40.39665899036715, 40.097806334421, 39.79895367847485, 39.5001010225287, 39.201248366582554, 38.902395710636405, 38.603543054690256, 38.30469039874411, 38.00583774279796, 37.70698508685181, 37.40813243090566, 37.10927977495951, 36.81042711901336, 36.51157446306721, 36.21272180712106, 35.913869151174914, 35.615016495228765, 35.316163839282616, 35.01731118333647, 34.71845852739032, 34.41960587144417, 34.12075321549802, 33.82190055955187, 33.52304790360572, 33.22419524765957, 32.925342591713424, 32.626489935767275, 32.327637279821126, 32.02878462387498, 31.729931967928827, 31.43107931198268, 31.13222665603653, 30.83337400009038, 30.53452134414423, 30.235668688198082, 29.936816032251933, 29.637963376305784, 29.339110720359635, 29.040258064413486, 28.741405408467337, 28.442552752521188, 28.142882213949736, 27.84317578598392, 27.54432313003777, 27.24465259146632, 26.944946163500504, 26.646093507554355, 26.346422968982903, 26.046716541017087, 25.747863885070938, 25.448193346499487, 25.14848691853367, 24.84963426258752, 24.54996372401607, 24.250257296050254, 23.951404640104105, 23.651734101532654, 23.352027673566838, 23.05317501762069, 22.753504479049237, 22.45379805108342, 22.154945395137272, 21.85527485656582, 21.555568428600004, 21.256715772653855, 20.957045234082404, 20.657338806116588, 20.35848615017044, 20.058815611598988, 19.75910918363317, 19.460256527687022, 19.161403871740873, 18.861733333169422, 18.262992294338286, 17.975929435982444, 17.718933055685675, 17.483359336091475, 17.22765773210373, 16.97066135180696, 16.745326292324176, 16.55899835589195, 16.390942167358677, 16.239760955576184, 16.157658478949845, 16.149809986517475, 16.21671020029694, 16.286055133461662, 16.30135618108382, 16.436077341921948, 16.54372769424971, 16.717521603757447, 16.921974872904734, 17.15095741107001, 17.403650477012405, 17.6563435429548, 17.909036608897196, 18.178774086152917]
#traj_y = [12.03, 12.014182495318076, 11.997275248392363, 11.98145774371044, 11.964550496784726, 11.948732992102803, 11.93182574517709, 11.916008240495167, 11.899100993569453, 11.88328348888753, 11.866376241961817, 11.850558737279894, 11.83365149035418, 11.817833985672257, 11.800926738746544, 11.78510923406462, 11.768201987138907, 11.752384482456984, 11.73547723553127, 11.719659730849347, 11.702752483923634, 11.68693497924171, 11.670027732315997, 11.670027732315997, 11.654210227634074, 11.63730298070836, 11.63730298070836, 11.621485476026438, 11.604578229100724, 11.604578229100724, 11.588760724418801, 11.571853477493088, 11.571853477493088, 11.556035972811165, 11.539128725885451, 11.539128725885451, 11.523311221203528, 11.506403974277815, 11.506403974277815, 11.490586469595891, 11.473679222670178, 11.473679222670178, 11.473679222670178, 11.457861717988255, 11.440954471062541, 11.440954471062541, 11.425136966380618, 11.408229719454905, 11.408229719454905, 11.392412214772982, 11.375504967847268, 11.375504967847268, 11.359687463165345, 11.342780216239632, 11.342780216239632, 11.326962711557709, 11.310055464631995, 11.310055464631995, 11.294237959950072, 11.277330713024359, 11.277330713024359, 11.261513208342436, 11.244605961416722, 11.244605961416722, 11.228788456734799, 11.211881209809086, 11.211881209809086, 11.196063705127163, 11.179156458201449, 11.179156458201449, 11.163338953519526, 11.146431706593813, 11.146431706593813, 11.13061420191189, 11.113706954986176, 11.113706954986176, 11.097889450304253, 11.08098220337854, 11.08098220337854, 11.065164698696616, 11.048257451770903, 11.048257451770903, 11.03243994708898, 11.015532700163266, 11.015532700163266, 10.999715195481343, 10.98280794855563, 10.98280794855563, 10.966990443873707, 10.950083196947993, 10.950083196947993, 10.93426569226607, 10.917358445340357, 10.917358445340357, 10.901540940658434, 10.88463369373272, 10.868816189050797, 10.851908942125084, 10.83609143744316, 10.819184190517447, 10.803366685835524, 10.78645943890981, 10.770641934227887, 10.753734687302174, 10.73791718262025, 10.721009935694537, 10.705192431012614, 10.6882851840869, 10.672467679404978, 10.655560432479264, 10.639742927797341, 10.622835680871628, 10.607018176189705, 10.590110929263991, 10.574293424582068, 10.557386177656355, 10.541568672974432, 10.524661426048718, 10.508843921366795, 10.491936674441082, 10.476119169759158, 10.459211922833445, 10.443394418151522, 10.410702150837812, 10.393794903912099, 10.430109794085727, 10.539256188139607, 10.714354150242105, 10.944366552195289, 11.214794787978917, 11.508592679151816, 11.807240963980616, 12.104219261667689, 12.403208230853307, 12.702197200038926, 13.001186169224544, 13.300175138410163, 13.599164107595781, 14.191170740634517, 14.459870324050149, 14.687314612492626, 14.859166878456474, 14.964594583014497, 14.996952194277869, 15.006267324414397, 15.032479726706962, 15.058692128999526, 15.084904531292091, 15.111116933584656, 15.13732933587722, 15.163541738169785, 15.18975414046235, 15.215966542754915, 15.24217894504748, 15.268391347340044, 15.294603749632609, 15.320816151925174, 15.347028554217738, 15.373240956510303, 15.399453358802868, 15.425665761095432, 15.451878163387997, 15.478090565680562, 15.504302967973127, 15.530515370265691, 15.556727772558256, 15.58294017485082, 15.609152577143385, 15.63536497943595, 15.661577381728515, 15.68778978402108, 15.714002186313644, 15.740214588606209, 15.766426990898774, 15.792639393191338, 15.818851795483903, 15.845064197776468, 15.871276600069033, 15.897489002361597, 15.923701404654162, 15.949913806946727, 15.976126209239291, 16.002338611531854, 16.02855101382442, 16.054763416116984, 16.08097581840955, 16.107188220702113, 16.133400622994678, 16.159613025287243, 16.185825427579807, 16.212037829872372, 16.238250232164937, 16.2644626344575, 16.290675036750066, 16.31688743904263, 16.343099841335196, 16.36931224362776, 16.395524645920325, 16.42173704821289, 16.447949450505455, 16.47416185279802, 16.500374255090584, 16.52658665738315, 16.552799059675714, 16.57901146196828, 16.605223864260843, 16.631436266553408, 16.657648668845972, 16.683861071138537, 16.710073473431102, 16.720479381646417, 16.72979451178294, 16.756006914075506, 16.76641282229082, 16.775727952427346, 16.80194035471991, 16.812346262935225, 16.82166139307175, 16.847873795364315, 16.85827970357963, 16.867594833716154, 16.89380723600872, 16.904213144224034, 16.91352827436056, 16.939740676653123, 16.95014658486844, 16.959461715004963, 16.985674117297528, 16.996080025512843, 17.005395155649367, 17.031607557941932, 17.042013466157247, 17.05132859629377, 17.077540998586336, 17.08794690680165, 17.097262036938176, 17.12347443923074, 17.133880347446055, 17.14319547758258, 17.169407879875145, 17.19562028216771, 17.206026190383024, 17.20511537314417, 17.1207282660266, 16.967499257645496, 16.781743981444382, 16.62636393699468, 16.473134928613575, 16.275309688612758, 16.04119824378359, 15.792868156784124, 15.534661825143953, 15.2469372140539, 14.947830761997723, 14.656196350634186, 14.365133558887328, 14.065673056391333, 13.768485052788987, 13.489311862566852, 13.245750893786733, 13.026208504406101, 12.833612383701446, 12.671914472692606, 12.510216561683766, 12.348518650674926, 12.219027485498255]
'''fine tuned q1'''
traj_x = [11.049999999999999, 11.34943366737748, 11.648807780511673, 11.948241447889155, 12.247615561023347, 12.547049228400828, 12.84642334153502, 13.145857008912502, 13.445231122046694, 13.744664789424176, 14.044038902558368, 14.34347256993585, 14.642846683070042, 14.942280350447524, 15.241654463581716, 15.541088130959197, 15.84046224409339, 16.139895911470866, 16.439270024605058, 16.73870369198254, 17.038077805116732, 17.337511472494214, 17.636885585628406, 17.936885585628453, 18.236319253005934, 18.535693366140126, 18.835693366140173, 19.135127033517655, 19.434501146651847, 19.734501146651894, 20.033934814029376, 20.333308927163568, 20.633308927163615, 20.932742594541097, 21.23211670767529, 21.532116707675335, 21.831550375052817, 22.13092448818701, 22.430924488187056, 22.730358155564538, 23.02973226869873, 23.329732268698777, 23.629732268698824, 23.929165936076306, 24.228540049210498, 24.528540049210545, 24.827973716588026, 25.12734782972222, 25.427347829722265, 25.726781497099747, 26.02615561023394, 26.326155610233986, 26.625589277611468, 26.92496339074566, 27.224963390745707, 27.52439705812319, 27.82377117125738, 28.123771171257427, 28.42320483863491, 28.7225789517691, 29.022578951769148, 29.32201261914663, 29.621386732280822, 29.92138673228087, 30.22082039965835, 30.520194512792543, 30.82019451279259, 31.11962818017007, 31.419002293304263, 31.71900229330431, 32.01843596068179, 32.31781007381598, 32.61781007381592, 32.91724374119339, 33.21661785432757, 33.516617854327514, 33.816051521704985, 34.11542563483917, 34.41542563483911, 34.71485930221658, 35.014233415350766, 35.31423341535071, 35.61366708272818, 35.91304119586236, 36.2130411958623, 36.512474863239774, 36.81184897637396, 37.1118489763739, 37.41128264375137, 37.710656756885555, 38.010656756885496, 38.31009042426297, 38.60946453739715, 38.90946453739709, 39.20889820477456, 39.60827231790875, 39.90770598528622, 40.207080098420406, 40.50651376579788, 40.80588787893206, 41.10532154630953, 41.40469565944372, 41.70412932682119, 42.003503439955374, 42.302937107332845, 42.60231122046703, 42.9017448878445, 43.201119000978686, 43.50055266835616, 43.79992678149034, 44.09936044886781, 44.398734562002, 44.69816822937947, 44.997542342513654, 45.296976009891125, 45.59635012302531, 45.89578379040278, 46.195157903536966, 46.49459157091444, 46.79396568404862, 47.09339935142609, 47.39277346456028, 47.69220713193775, 47.990420504639104, 48.38979461777329, 48.68679208787493, 48.96538378401846, 49.20800895205065, 49.3993739526198, 49.527416280722846, 49.5840649138701, 49.56574906106674, 49.52434126812412, 49.49973240172751, 49.47512353533091, 49.450514668934304, 49.4259058025377, 49.401296936141094, 49.31613299427467, 49.18450168201439, 48.99009138354752, 48.7451565612413, 48.46513644123788, 48.16768181698668, 47.86797538902088, 47.56912273307473, 47.27027007712858, 46.97141742118243, 46.67256476523628, 46.37371210929013, 46.07485945334398, 45.776006797397834, 45.477154141451685, 45.178301485505536, 44.87944882955939, 44.58059617361324, 44.28174351766709, 43.98289086172094, 43.68403820577479, 43.38518554982864, 43.08633289388249, 42.78748023793634, 42.488627581990194, 42.189774926044045, 41.890922270097896, 41.59206961415175, 41.2932169582056, 40.99436430225945, 40.6955116463133, 40.39665899036715, 40.097806334421, 39.79895367847485, 39.5001010225287, 39.201248366582554, 38.902395710636405, 38.603543054690256, 38.30469039874411, 38.00583774279796, 37.70698508685181, 37.40813243090566, 37.10927977495951, 36.81042711901336, 36.51157446306721, 36.21272180712106, 35.913869151174914, 35.615016495228765, 35.316163839282616, 35.01731118333647, 34.71845852739032, 34.41960587144417, 34.12075321549802, 33.82190055955187, 33.52304790360572, 33.22419524765957, 32.925342591713424, 32.626489935767275, 32.327637279821126, 32.02878462387498, 31.729931967928827, 31.43107931198268, 31.13222665603653, 30.83337400009038, 30.53452134414423, 30.235668688198082, 29.936816032251933, 29.637963376305784, 29.339110720359635, 29.040258064413486, 28.741405408467337, 28.442552752521188, 28.142882213949736, 27.84317578598392, 27.54432313003777, 27.24465259146632, 26.944946163500504, 26.646093507554355, 26.346422968982903, 26.046716541017087, 25.747863885070938, 25.448193346499487, 25.14848691853367, 24.84963426258752, 24.54996372401607, 24.250257296050254, 23.951404640104105, 23.651734101532654, 23.352027673566838, 23.05317501762069, 22.753504479049237, 22.45379805108342, 22.154945395137272, 21.85527485656582, 21.555568428600004, 21.256715772653855, 20.957045234082404, 20.657338806116588, 20.35848615017044, 20.058815611598988, 19.75910918363317, 19.460256527687022, 19.161403871740873, 18.861733333169422, 18.262992294338286, 17.975929435982444, 17.718933055685675, 17.483359336091475, 17.238436376935326, 17.005813515872287, 16.827394817636286, 16.71442672976843, 16.622991675348313, 16.550528036206604, 16.532015076513172, 16.514591523912404, 16.444566330775096, 16.372102691633387, 16.30207749849608, 16.32961385935437, 16.331742408759183, 16.408328975687795, 16.554546001056792, 16.761176838171167, 17.01519671500334, 17.300593737915293, 17.586734719182356, 17.872131742094307, 18.258272723361372, 18.543669746273324, 18.842454194017794, 19.14221912647003, 19.442061349092462, 19.741903571714893, 20.041745794337324, 20.341588016959754, 20.641430239582185, 20.941272462204616]
traj_y = [12.03, 12.014182495318076, 11.997275248392363, 11.98145774371044, 11.964550496784726, 11.948732992102803, 11.93182574517709, 11.916008240495167, 11.899100993569453, 11.88328348888753, 11.866376241961817, 11.850558737279894, 11.83365149035418, 11.817833985672257, 11.800926738746544, 11.78510923406462, 11.768201987138907, 11.752384482456984, 11.73547723553127, 11.719659730849347, 11.702752483923634, 11.68693497924171, 11.670027732315997, 11.670027732315997, 11.654210227634074, 11.63730298070836, 11.63730298070836, 11.621485476026438, 11.604578229100724, 11.604578229100724, 11.588760724418801, 11.571853477493088, 11.571853477493088, 11.556035972811165, 11.539128725885451, 11.539128725885451, 11.523311221203528, 11.506403974277815, 11.506403974277815, 11.490586469595891, 11.473679222670178, 11.473679222670178, 11.473679222670178, 11.457861717988255, 11.440954471062541, 11.440954471062541, 11.425136966380618, 11.408229719454905, 11.408229719454905, 11.392412214772982, 11.375504967847268, 11.375504967847268, 11.359687463165345, 11.342780216239632, 11.342780216239632, 11.326962711557709, 11.310055464631995, 11.310055464631995, 11.294237959950072, 11.277330713024359, 11.277330713024359, 11.261513208342436, 11.244605961416722, 11.244605961416722, 11.228788456734799, 11.211881209809086, 11.211881209809086, 11.196063705127163, 11.179156458201449, 11.179156458201449, 11.163338953519526, 11.146431706593813, 11.146431706593813, 11.13061420191189, 11.113706954986176, 11.113706954986176, 11.097889450304253, 11.08098220337854, 11.08098220337854, 11.065164698696616, 11.048257451770903, 11.048257451770903, 11.03243994708898, 11.015532700163266, 11.015532700163266, 10.999715195481343, 10.98280794855563, 10.98280794855563, 10.966990443873707, 10.950083196947993, 10.950083196947993, 10.93426569226607, 10.917358445340357, 10.917358445340357, 10.901540940658434, 10.88463369373272, 10.868816189050797, 10.851908942125084, 10.83609143744316, 10.819184190517447, 10.803366685835524, 10.78645943890981, 10.770641934227887, 10.753734687302174, 10.73791718262025, 10.721009935694537, 10.705192431012614, 10.6882851840869, 10.672467679404978, 10.655560432479264, 10.639742927797341, 10.622835680871628, 10.607018176189705, 10.590110929263991, 10.574293424582068, 10.557386177656355, 10.541568672974432, 10.524661426048718, 10.508843921366795, 10.491936674441082, 10.476119169759158, 10.459211922833445, 10.443394418151522, 10.410702150837812, 10.393794903912099, 10.430109794085727, 10.539256188139607, 10.714354150242105, 10.944366552195289, 11.214794787978917, 11.508592679151816, 11.807240963980616, 12.104219261667689, 12.403208230853307, 12.702197200038926, 13.001186169224544, 13.300175138410163, 13.599164107595781, 14.191170740634517, 14.459870324050149, 14.687314612492626, 14.859166878456474, 14.964594583014497, 14.996952194277869, 15.006267324414397, 15.032479726706962, 15.058692128999526, 15.084904531292091, 15.111116933584656, 15.13732933587722, 15.163541738169785, 15.18975414046235, 15.215966542754915, 15.24217894504748, 15.268391347340044, 15.294603749632609, 15.320816151925174, 15.347028554217738, 15.373240956510303, 15.399453358802868, 15.425665761095432, 15.451878163387997, 15.478090565680562, 15.504302967973127, 15.530515370265691, 15.556727772558256, 15.58294017485082, 15.609152577143385, 15.63536497943595, 15.661577381728515, 15.68778978402108, 15.714002186313644, 15.740214588606209, 15.766426990898774, 15.792639393191338, 15.818851795483903, 15.845064197776468, 15.871276600069033, 15.897489002361597, 15.923701404654162, 15.949913806946727, 15.976126209239291, 16.002338611531854, 16.02855101382442, 16.054763416116984, 16.08097581840955, 16.107188220702113, 16.133400622994678, 16.159613025287243, 16.185825427579807, 16.212037829872372, 16.238250232164937, 16.2644626344575, 16.290675036750066, 16.31688743904263, 16.343099841335196, 16.36931224362776, 16.395524645920325, 16.42173704821289, 16.447949450505455, 16.47416185279802, 16.500374255090584, 16.52658665738315, 16.552799059675714, 16.57901146196828, 16.605223864260843, 16.631436266553408, 16.657648668845972, 16.683861071138537, 16.710073473431102, 16.720479381646417, 16.72979451178294, 16.756006914075506, 16.76641282229082, 16.775727952427346, 16.80194035471991, 16.812346262935225, 16.82166139307175, 16.847873795364315, 16.85827970357963, 16.867594833716154, 16.89380723600872, 16.904213144224034, 16.91352827436056, 16.939740676653123, 16.95014658486844, 16.959461715004963, 16.985674117297528, 16.996080025512843, 17.005395155649367, 17.031607557941932, 17.042013466157247, 17.05132859629377, 17.077540998586336, 17.08794690680165, 17.097262036938176, 17.12347443923074, 17.133880347446055, 17.14319547758258, 17.169407879875145, 17.19562028216771, 17.206026190383024, 17.20511537314417, 17.1207282660266, 16.967499257645496, 16.781743981444382, 16.6087599975277, 16.420576913787578, 16.180383165711433, 15.903319130480273, 15.617748919434577, 15.327446853480103, 15.02816774472562, 14.728823236794947, 14.437923355699786, 14.147621289745311, 13.85672140865015, 13.566419342695676, 13.267217508188393, 12.977975799126257, 12.716926282774786, 12.500523959200128, 12.34240953648904, 12.252549602101755, 12.165087568426486, 12.075227634039202, 11.987765600363932, 11.897905665976648, 11.88196445268766, 11.889154715922828, 11.879426327935004, 11.86969793994718, 11.859969551959356, 11.850241163971532, 11.840512775983708, 11.830784387995884]

###############################################################################

## INIT #######################################################################
default_init_pt = [0.0, 0.0, 0.0, 0.0] # [x, y, yaw, v], units: [m, m, rad, m/s]
###############################################################################


def param_init():
    """Initialization handles use with just python or in a launch file
    """
    # grab parameters from launch-file
    start_pt_param = rospy.search_param('start_pt')
    is_sim_param = rospy.search_param('is_sim')
    use_rviz_param = rospy.search_param('use_rviz')
    use_matplotlib_param = rospy.search_param('use_matplotlib')
    run_lidar_param = rospy.search_param('run_lidar')

    start_pt = rospy.get_param(start_pt_param, default_init_pt)
    if isinstance(start_pt, str):
        start_pt = start_pt.split(',')
        start_pt = [float(curr) for curr in start_pt]
        start_pt = VehicleState(*start_pt)

    is_sim = rospy.get_param(is_sim_param, True)
    use_rviz = rospy.get_param(use_rviz_param, False)
    use_matplotlib = rospy.get_param(use_matplotlib_param, False)
    run_lidar = rospy.get_param(run_lidar_param, True)

    return start_pt, is_sim, use_rviz, use_matplotlib, run_lidar

def callback_scan(scan):
    """ Callback for lidarscan """
    ranges = scan.ranges
    min_dist = np.nanmin(ranges) # TODO: Make available as self.min_dist etc.?

def main():
    rospy.init_node('floor2_team1')
    start_pt, is_sim, use_rviz, use_matplotlib, _run_lidar = param_init()

    # select data handler based on the ros params
    if use_rviz:
        DataHandler = RVIZPathHandler
    elif use_matplotlib:
        DataHandler = TrajDataHandler
    else:
        DataHandler = BasicDataHandler

    if is_sim:
        # start the simulation
        model_for_sim = SimpleBicycleModel(start_pt)
        simulator = SimSVEA(vehicle_name, model_for_sim,
                            dt=dt, start_paused=True, run_lidar=_run_lidar).start()

    lidar_sub = rospy.Subscriber("/scan", LaserScan, callback_scan)

    # start pure pursuit SVEA manager
    svea = SVEAMPC(
        vehicle_name,
        LocalizationInterface,
        MPC,
        traj_x, traj_y,
        data_handler = DataHandler,
        target_velocity=params.target_velocity,
        dl = dt*params.low_lim,
        low_lim = params.low_lim,
    )
    print("target_velocity", target_velocity)
    ulb = [-1e2,-np.deg2rad(40)]
    uub = [ 1e2, np.deg2rad(40)]
    xlb = [-np.inf]*3+[-1]
    xub = [ np.inf]*3+[3.6]

    svea.controller.build_solver(
        dt,
        Q=params.Q,
        R=params.R,
        P=params.P,
        ulb=ulb,
        uub=uub,
        xlb=xlb,
        xub=xub,
        max_cpu_time=0.8*dt,
        horizon=params.horizon,
        model_type=params.model_type,
        solver_=params.solver_,
        TAU = params.TAU,
        N_IND_SEARCH = params.N_IND_SEARCH,
    )
    svea.start(wait=True)

    track = Track(vehicle_name, publish_track=True)
    track.start()

    if is_sim:
        # start simulation
        simulator.toggle_pause_simulation()

    # simulation loop
    svea.controller.target_velocity = target_velocity
    while not svea.is_finished and not rospy.is_shutdown():
        state = svea.wait_for_state()

        # compute control input via pure pursuit
        steering, velocity = svea.compute_control()
        #print("velocity = ", velocity, "steering = ", steering)
        svea.send_control(steering, velocity)

        # visualize data
        if use_matplotlib or use_rviz:
            svea.visualize_data()
        else:
            svea.visualize_data()
            # rospy.loginfo_throttle(1, state)

    if not rospy.is_shutdown():
        rospy.loginfo("Trajectory finished!")

    rospy.spin()


if __name__ == '__main__':
    main()
